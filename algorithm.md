**Badminton Manager**에 적용된 매칭 알고리즘은 **'공정성(Fairness)'**과 **'다양성(Variety)'**을 수학적으로 최적화하는 **비용 최소화(Cost Minimization)** 방식을 따릅니다.

알고리즘은 크게 **1. 선발(Selection)** 단계와 **2. 팀 편성(Partitioning)** 단계로 나뉩니다.

---

## 1. 선발 단계 (Selection Phase)
대기자 명단(Pool)에서 코트에 들어갈 4명을 뽑는 과정입니다.

### 수식 1: 우선순위 점수 ($Priority Score$)
모든 대기자 $P_i$에 대해 다음과 같이 정렬합니다.

$$
Sort(P) = \min(G_i) \rightarrow Random(P_{same})
$$

*   **$G_i$ (Game Count):** 플레이어 $i$가 현재까지 치른 총 게임 수.
*   **$Random$:** $G_i$ 값이 동일한 그룹 내에서는 **무작위 셔플(Fisher-Yates Shuffle)** 적용.

> **해석:**
> 1.  게임 수($G$)가 적은 사람이 무조건 0순위입니다. (늦게 온 사람도 빨리 게임에 투입됨)
> 2.  게임 수가 같다면, 먼저 온 순서(Timestamp)를 무시하고 **100% 랜덤**으로 섞습니다. 이는 특정 인원끼리만 순환되는 '고인물 파티'를 방지합니다.

---

## 2. 팀 편성 단계 (Partitioning Phase)
선발된 4명을 $A$팀과 $B$팀으로 나누는 과정입니다. 여기서 **파트너 이력(History)**과 **실력(Tier)**을 기반으로 최적의 조합을 찾습니다.

### 변수 정의
*   **$H(x, y)$ (History Score):** 최근 100경기 내에서 플레이어 $x$와 $y$가 **같은 팀(파트너)**이었던 횟수.
*   **$T(x)$ (Tier Score):** 플레이어 $x$의 급수 점수 (자강=5, A=5, ..., F=0).
*   **$C_{total}$ (Total Cost):** 해당 조합의 불공정 지수 (낮을수록 좋음).

---

### Case A: 일반 경기 (남복/여복/자율)

선발된 4명을 티어($T$)가 높은 순서대로 정렬하여 $P_1, P_2, P_3, P_4$라고 정의합니다.
($T(P_1) \ge T(P_2) \ge T(P_3) \ge T(P_4)$)

가능한 팀 조합은 3가지이며, 각 조합의 비용($C$)을 계산합니다.

#### 1. 정석 밸런스형 (Balanced)
가장 잘하는 사람($P_1$)과 못하는 사람($P_4$)을 묶습니다.
$$
C_1 = H(P_1, P_4) + H(P_2, P_3)
$$

#### 2. 차선 밸런스형 (Alternative)
중간 실력끼리 섞습니다.
$$
C_2 = H(P_1, P_3) + H(P_2, P_4)
$$

#### 3. 실력 불균형형 (Unbalanced) - 비추천
잘하는 사람끼리($P_1, P_2$) 묶는 경우, **페널티($\alpha$)**를 부여합니다. 코드상 $\alpha = 5$입니다.
$$
C_3 = H(P_1, P_2) + H(P_3, P_4) + 5
$$

#### 🎯 최종 결정 수식
$$
FinalTeam = \text{argmin}(C_1, C_2, C_3)
$$
> **해석:**
> 기본적으로 $C_1$(정석 밸런스)이 선택될 확률이 가장 높습니다. 하지만 만약 $P_1$과 $P_4$가 이미 파트너를 5번이나 했다면($H=5$), $C_1$ 값은 높아지고, 아직 한 번도 안 해본 $C_2$ 조합($H=0$)이 선택됩니다. 즉, **밸런스를 유지하되 "안 해본 사람"과의 매칭을 최우선**합니다.

---

### Case B: 혼합 복식 (Mixed Doubles)

선발된 4명 중 남자를 $M$, 여자를 $F$라 하고 티어순으로 정렬합니다.
($M_1 \ge M_2$, $F_1 \ge F_2$)

혼복은 남녀 성비가 고정되므로 2가지 경우의 수만 존재합니다.

#### 1. 조합 1
$$
C_1 = H(M_1, F_1) + H(M_2, F_2)
$$

#### 2. 조합 2
$$
C_2 = H(M_1, F_2) + H(M_2, F_1)
$$

#### 🎯 최종 결정 수식
$$
FinalTeam = \text{argmin}(C_1, C_2)
$$
> **해석:**
> 혼복 역시 밸런스보다는 **"이전에 파트너를 해봤는가?"**를 기준으로 팀을 나눕니다. 만약 두 조합의 히스토리 점수가 같다면($C_1 = C_2$), 코드 로직상 조합 1이 선택됩니다.

---

## 3. 요약 (Summary)

이 알고리즘의 목표 함수(Objective Function)는 다음과 같습니다.

$$
\text{Maximize } (Diversity) \text{ subject to } (Fairness \cap Balance)
$$

1.  **누구나 똑같은 횟수**로 게임을 뛴다. ($Sort(G)$)
2.  게임 수가 같다면 **순서는 운**에 맡긴다. ($Shuffle$)
3.  팀을 짤 때는 **실력 균형**을 맞추되, **새로운 파트너와의 경험**을 더 중요시한다. ($Minimize \sum H$)